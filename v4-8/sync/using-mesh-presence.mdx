---
title: Using Mesh Presence
---

This article provides a high-level overview of *peer-presence data* within the mesh network. Peer-presence data, or *presence* for short, refers to the information Ditto uses within the mesh network to track peer connectivity within physical proximity.

To get realtime updates about changes to presence data, use the Presence API. This article includes instructions on how to implement Ditto's Presence APIs to enable the following end-user functionality for network monitoring and management within your app:

- Setting and updating peer-specific information, such as name, role, and location.
- Viewing information about other peers currently connected in the mesh.

# Accessing Presence APIs

To access API methods for mesh presence functionality, call the the `presence` namespace on the root `Ditto` object:

<Tabs>
    <Tab title="Swift">
    ```swift
    ditto.presence
    ```
    </Tab>
    <Tab title="Kotlin">
    ```kotlin
    ditto.presence
    ```
    </Tab>
    <Tab title="JS">
    ```javascript
    ditto.presence
    ```
    </Tab>
    <Tab title="Java">
    ```java
    ditto.getPresence();
    ```
    </Tab>
    <Tab title="C#">
    ```csharp
    Ditto.Presence
    ```
    </Tab>
    <Tab title="C++">
    ```cpp
    ditto.get_presence()
    ```
    </Tab>
    <Tab title="Rust">
    ```rust
    ditto.presence()
    ```
    </Tab>
    <Tab title="Dart">
    ```dart
    ditto.presence
    ```
    </Tab>
</Tabs>

# Presence Graph

Once discovered in the mesh, peers automatically establish a *presence graph* by advertising their device presence within the mesh and forming network connections with other connected peers.

The presence graph is a data structure representing the current state of the mesh from a specific peer's point of view.

You can integrate the presence graph into your app to enable end-user functionality like network monitoring, management, and transport optimization. For example, once implemented, end users can input personal information, such as their name, and inspect remote peers connected within the mesh. For more information, see <a href="https://github.com/getditto/DittoSwiftTools" target="_blank">DittoSwiftTools</a> on GitHub.

## Accessing Presence Graphs

To view your current presence graph:

<Tabs>
    <Tab title="Swift">
    ```swift
    let presenceGraph = ditto.presence.graph
    ```
    </Tab>
    <Tab title="Kotlin">
    ```kotlin
    val presenceGraph = ditto.presence.graph
    ```
    </Tab>
    <Tab title="JS">
    ```javascript
    const presenceGraph = ditto.presence.graph
    ```
    </Tab>
    <Tab title="Java">
    ```java
    DittoPresenceGraph graph = ditto.getPresence().getGraph();
    ```
    </Tab>
    <Tab title="C#">
    ```csharp
    var PresenceGraph = Ditto.Presence.Graph
    ```
    </Tab>
    <Tab title="C++">
    ```cpp
    auto presenceGraph = ditto.get_presence().graph()
    ```
    </Tab>
    <Tab title="Rust">
    ```rust
    let presenceGraph = ditto.presence().graph()
    ```
    </Tab>
    <Tab title="Dart">
    ```dart
    final presenceGraph = await ditto.presence.graph;
    ```
    </Tab>
</Tabs>

Once invoked, Ditto returns the following object, allowing you to perform actions like displaying the status of connected peers and managing network resources:

<Tabs>
    <Tab title="Presence Graph Response">
    ```json
    {
      localPeer: Peer;
      remotePeers: Peer[];
    }
    ```
    </Tab>
</Tabs>

The `localPeer` is the metadata set by the end user within your app. The `remotePeers` property provides an `array` of the other client devices connected to the mesh. (See [End-User Defined Metadata]())

## Observing Presence Graph Modifications

To monitor and handle changes observed to the presence graph, call the change handler with the updated graph object as follows:

<Warning>
Make sure the observer response object remains in memory during runtime; otherwise, Ditto removes it during the periodic garbage collection process running in the background, resulting in the change handler no longer being triggered.
</Warning>

<Tabs>
    <Tab title="Swift">
    ```swift
    let presenceObserver = ditto.presence.observe { presenceGraph in
        // observe changes to the presence graph
    }
    ```
    </Tab>
    <Tab title="Kotlin">
    ```kotlin
    val presenceObserver = ditto.presence.observe { graph ->
        // observe changes to the presence graph
    }
    ```
    </Tab>
    <Tab title="JS">
    ```javascript
    const presenceObserver = ditto.presence.observe((presenceGraph) => {
        // observe changes to the presence graph
    })
    ```
    </Tab>
    <Tab title="Java">
    ```java
    DittoPresenceObserver presenceObserver = ditto.getPresence().observe(graph -> {
        // observe changes to the presence graph
    });
    ```
    </Tab>
    <Tab title="C#">
    ```csharp
    var presenceObserver = Ditto.Presence.Observe((DittoPresenceGraph graph) =>
    {
        // Observe changes to the presence graph
    });
    ```
    </Tab>
    <Tab title="C++">
    ```cpp
    auto presenceObserver = ditto.get_presence().observe([&](PresenceGraph graph) {
        // observe changes to the presence graph
    });
    ```
    </Tab>
    <Tab title="Rust">
    ```rust
    let presenceObserver = ditto.presence().observe(move |_graph| {
        // observe changes to the presence graph
    });
    ```
    </Tab>
    <Tab title="Dart">
    ```dart
    final presenceObserver = await ditto.presence.observe((graph) {
      // observe changes to the presence graph
    });
    ```
    </Tab>
</Tabs>

# Peer Key Identifier

Once discovered in the mesh, each peer device running Ditto is automatically assigned a *peer key*.

## Reading Peer Keys

View your local device's peer key or the peer key identifying a specific remote device:

- To retrieve the peer key for the current peer:

<Tabs>
    <Tab title="Swift">
    ```swift
    ditto.presence.graph.localPeer.peerKeyString
    ```
    </Tab>
    <Tab title="Kotlin">
    ```kotlin
    ditto.presence.graph.localPeer.peerKeyString
    ```
    </Tab>
    <Tab title="JS">
    ```javascript
    ditto.presence.graph.localPeer.peerKeyString
    ```
    </Tab>
    <Tab title="Java">
    ```java
    ditto.getPresence().getGraph().localPeer.peerKeyString
    ```
    </Tab>
    <Tab title="C#">
    ```csharp
    Ditto.Presence.Graph.LocalPeer.PeerKeyString
    ```
    </Tab>
    <Tab title="C++">
    ```cpp
    ditto.get_presence().graph().local_peer.peer_key_string
    ```
    </Tab>
    <Tab title="Rust">
    ```rust
    ditto.presence().graph().local_peer.peer_key_string
    ```
    </Tab>
    <Tab title="Dart">
    ```dart
    final graph = await ditto.presence.graph;
    graph.localPeer.peerKeyString
    ```
    </Tab>
</Tabs>

- To retrieve the peer key for a remote peer:

<Tabs>
    <Tab title="Swift">
    ```swift
    let remotePeers = presenceGraph.remotePeers
    let firstPeer = remotePeers.first!

    let peerkeyString = firstPeer.peerKeyString
    ```
    </Tab>
    <Tab title="Kotlin">
    ```kotlin
    val remotePeers = ditto.presence.graph.remotePeers
    val firstPeer = remotePeers.first()

    val peerKeyString = firstPeer.peerKeyString
    ```
    </Tab>
    <Tab title="JS">
    ```javascript
    const remotePeers = ditto.presence.graph.remotePeers
    const firstPeer = remotePeers[0]

    const peerkeyString = firstPeer.peerKeyString
    ```
    </Tab>
    <Tab title="Java">
    ```java
    List<DittoPeer> remotePeers = ditto.getPresence().getGraph().remotePeers
    DittoPeer firstPeer = remotePeers.get(0)

    String peerKeyString = firstPeer.peerKeyString
    ```
    </Tab>
    <Tab title="C#">
    ```csharp
    DittoPeer remotePeers = ditto.presence.graph.remotePeers
    const firstPeer = remotePeers[0]

    const peerkeyString = firstPeer.peerKeyString
    ```
    </Tab>
    <Tab title="C++">
    ```cpp
    auto remotePeers = ditto.get_presence().graph().remote_peers;
    auto firstPeer = remotePeers[0];

    auto peerkeyString = firstPeer.peer_key_string;
    ```
    </Tab>
    <Tab title="Rust">
    ```rust
    let remote_peers = ditto.presence().graph().remote_peers;
    let first_peer = &remote_peers[0];

    let peer_key_string = &first_peer.peer_key_string;
    ```
    </Tab>
    <Tab title="Dart">
    ```dart
    final graph = await ditto.presence.graph;
    final firstPeer = graph.remotePeers[0];
    final peerKeyString = firstPeer.peerKeyString;
    ```
    </Tab>
</Tabs>

# End-User Defined Peer Metadata

Using the peer-metadata property, you can provide each peer connected within the mesh the ability to set and view information about themselves or read information defined by other peers within the mesh.

<Warning>
Data added to the peer metadata object is shared during the connection handshake. Large data payloads may impact performance on low-bandwidth connections, such as BLE.
</Warning>

The following table provides an overview of key considerations to know before setting peer metadata, as well as Ditto's recommended best practices to ensure optimal mesh performance and avoid potential issues:

| **Consideration**                                                                                                                                                                                                                     | **Best Practice**                                                                                                                                                                                                                                            |
| ------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- | ------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------ |
| Peer metadata syncs across the mesh with each new connection. Therefore, sharing large data over low-bandwidth transports, such as Bluetooth Low Energy (LE), and low-quality connections may slow or disrupt the connection process. | Keep the size of peer metadata to a minimum, especially when syncing over Bluetooth LE or similar low-bandwidth transports. This is because peer metadata exceeding 128 KB, the maximum limit, results in the operation failing and Ditto throwing an error. |
| Peer metadata is visible to all peers connected in the mesh.                                                                                                                                                                          | Include only non-sensitive information in peer metadata.                                                                                                                                                                                                     |

## Setting Local Peer Metadata

To implement functionality providing end users the ability to define metadata, call the `setPeerMetadata` API method as follows:

<Tabs>
    <Tab title="Swift">
    ```swift
    // Setting via Object
    try ditto.presence.setPeerMetadata(["location": "inside"])

    // Setting via JSON String
    let jsonData = "{location:\"inside\"}".data(using: .utf8)!
    try ditto.presence.setPeerMetadataJSONData(jsonData)
    ```
    </Tab>
    <Tab title="Kotlin">
    ```kotlin
    // Setting via Object
    ditto.presence.peerMetadata = mapOf("number" to 1)

    // Setting via JSON String
    ditto.presence.peerMetadataJsonString =
        """
        {"location":"inside"}
        """.trimIndent()
    ```
    </Tab>
    <Tab title="JS">
    ```javascript
    // Setting via Object
    await ditto.presence.setPeerMetadata({ location: "inside" })

    // Setting via JSON String
    await ditto.presence.setPeerMetadataJSONString("{location:\"inside\"}")
    ```
    </Tab>
    <Tab title="Java">
    ```java
    // Setting via Object
    ditto.getPresence().setPeerMetadata(
        Collections.singletonMap("number", 1)
    );

    // Setting via JSON String
    ditto.getPresence().setPeerMetadataJsonString("{\"location\":\"inside\"}");
    ```
    </Tab>
    <Tab title="C#">
    ```csharp
    Ditto.Presence.SetPeerMetadata(new Dictionary<string, object>()  { { "location", "inside" } });
    ```
    </Tab>
    <Tab title="C++">
    ```cpp
    nlohmann::json metadata = {
        {"location", "inside"}
    };

    ditto.get_presence().set_peer_metadata(metadata);
    ```
    </Tab>
    <Tab title="Rust">
    ```rust
    let metadata = json!({
        "location": "inside",
    });
    ditto.presence().set_peer_metadata(&metadata)?;
    ```
    </Tab>
    <Tab title="Dart">
    ```dart
    // Setting via Object
    await ditto.presence.setPeerMetadata({ "location": "inside" })

    // Setting via JSON String
    await ditto.presence.setPeerMetadataJsonString('{"location": "inside"}')
    ```
    </Tab>
</Tabs>

## Reading Local Peer Metadata

Once set, inspect the metadata:

<Tabs>
    <Tab title="Swift">
    ```swift
    // Reading from the presence namespace
    ditto.presence.peerMetadata

    // Reading from the presence graph
    ditto.presence.graph.localPeer.peerMetadata
    ```
    </Tab>
    <Tab title="Kotlin">
    ```kotlin
    // Reading from the presence namespace
    ditto.presence.peerMetadata

    // Reading from the presence graph
    ditto.presence.graph.localPeer.peerMetadata
    ```
    </Tab>
    <Tab title="JS">
    ```javascript
    // Reading from the presence namespace
    ditto.presence.peerMetadata

    // Reading from the presence graph
    ditto.presence.graph.localPeer.peerMetadata
    ```
    </Tab>
    <Tab title="Java">
    ```java
    // Reading from the presence namespace
    Map<String, Object> metadata = ditto.getPresence().getPeerMetadata();

    // Reading from the presence graph
    Map<String, Object> metadata2 = ditto.getPresence().getGraph().localPeer.peerMetadata;
    ```
    </Tab>
    <Tab title="C#">
    ```csharp
    // Reading from the presence namespace
    Ditto.Presence.PeerMetadata;

    // Reading from the presence graph
    Ditto.Presence.Graph.LocalPeer.PeerMetadata;
    ```
    </Tab>
    <Tab title="C++">
    ```cpp
    // Reading from the presence namespace
    ditto.get_presence().peer_metadata()

    // Reading from the presence graph
    ditto.get_presence().graph().local_peer.peer_metadata
    ```
    </Tab>
    <Tab title="Rust">
    ```rust
    // Reading from the presence namespace
    ditto.presence().peer_metadata()

    // Reading from the presence graph
    ditto.presence().graph().local_peer.peer_metadata
    ```
    </Tab>
    <Tab title="Dart">
    ```dart
    // Reading from the presence namespace
    ditto.presence.peerMetadata

    // Reading from the presence graph
    (await ditto.presence.graph).localPeer.peerMetadata
    ```
    </Tab>
</Tabs>

## Reading Remote Peer Metadata

To inspect the metadata set by all other peers in the mesh:

<Tabs>
    <Tab title="Swift">
    ```swift
    let remotePeers = ditto.presence.graph.remotePeers
    let firstPeer = remotePeers.first!

    let peerMetadata = firstPeer.peerMetadata
    ```
    </Tab>
    <Tab title="Kotlin">
    ```kotlin
    val remotePeers = ditto.presence.graph.remotePeers
    val firstPeer = remotePeers.first()

    val peerMetadata = firstPeer.peerMetadata
    ```
    </Tab>
    <Tab title="JS">
    ```javascript
    const remotePeers = ditto.presence.graph.remotePeers
    const firstPeer = remotePeers[0]

    const peerMetadata = firstPeer.peerMetadata
    ```
    </Tab>
    <Tab title="Java">
    ```java
    List<DittoPeer> remotePeers = ditto.getPresence().getGraph().remotePeers;
    DittoPeer firstPeer = remotePeers.get(0);

    Map<String, Object> metadata = firstPeer.peerMetadata;
    ```
    </Tab>
    <Tab title="C#">
    ```csharp
    var RemotePeers = Ditto.Presence.Graph.RemotePeers.PeerMetadata;
    var FirstPeer = RemotePeers[0];

    var PeerMetadata = FirstPeer.PeerMetadata;
    ```
    </Tab>
    <Tab title="C++">
    ```cpp
    auto remotePeers = ditto.get_presence().graph().remote_peers;
    auto firstPeer = remotePeers[0];

    auto peerMetadata = firstPeer.peer_metadata();
    ```
    </Tab>
    <Tab title="Rust">
    ```rust
    let remote_peers = ditto.presence().graph().remote_peers;
    let first_peer = &remote_peers[0];

    let peer_metadata = &first_peer.peer_metadata;
    ```
    </Tab>
    <Tab title="Dart">
    ```dart
    final graph = await ditto.presence.graph;
    final firstPeer = graph.remotePeers[0];
    final metadata = firstPeer.peerMetadata;
    ```
    </Tab>
</Tabs>

# Identity Server Metadata

Identity server metadata is application information that is set when the user is authenticating. As part of the authentication process the application developer can provide information about the peer that is added to the user's peer object and shared with other peers in the mesh.

The identity server metadata is signed by the identity server and validated by all peers reading to prevent spoofing of the information.

## Setting Identity Server Metadata

The identity server metadata is set during the See [End-User Access>Setting Identity Server User Metadata](<./../Authentication & Authorization/Data Authorization.md>) for specifics.

## Reading Local Peer Identity Server Metadata

To inspect the identity server metadata of the local peer doing the following:

<Tabs>
    <Tab title="Swift">
    ```swift
    // Reading from the presence namespace
    ditto.presence.identityServiceMetadata

    // Reading from the presence graph
    ditto.presence.graph.localPeer.identityServiceMetadata
    ```
    </Tab>
    <Tab title="Kotlin">
    ```kotlin
    // Reading from the presence namespace
    ditto.presence.identityServiceMetadata

    // Reading from the presence graph
    ditto.presence.graph.localPeer.identityServiceMetadata
    ```
    </Tab>
    <Tab title="JS">
    ```javascript
    // Reading from the presence namespace
    ditto.presence.identityServiceMetadata

    // Reading from the presence graph
    ditto.presence.graph.localPeer.identityServiceMetadata
    ```
    </Tab>
    <Tab title="Java">
    ```java
    // Reading from the presence namespace
    Map<String, Object> metadata = ditto.getPresence().getIdentityServiceMetadata();

    // Reading from the presence graph
    Map<String, Object> metadata2 = ditto.getPresence().getGraph().localPeer.identityServiceMetadata;
    ```
    </Tab>
    <Tab title="C#">
    ```csharp
    // Reading from the presence namespace
    Ditto.Presence.IdentityServiceMetadata;

    // Reading from the presence graph
    Ditto.Presence.Graph.LocalPeer.IdentityServiceMetadata;
    ```
    </Tab>
    <Tab title="C++">
    ```cpp
    // Reading from the presence namespace
    ditto.get_presence().identity_service_metadata()

    // Reading from the presence graph
    ditto.get_presence().graph().local_peer.identity_service_metadata
    ```
    </Tab>
    <Tab title="Rust">
    ```rust
    // Reading from the presence namespace
    ditto.presence().identity_service_metadata()

    // Reading from the presence graph
    ditto.presence().graph().local_peer.identity_service_metadata
    ```
    </Tab>
    <Tab title="Dart">
    ```dart
    // Coming Soon
    ```
    </Tab>
</Tabs>

## Reading Remote Peer Identity Server Metadata

To inspect the identity server metadata set by other peers connected within the mesh:

<Tabs>
    <Tab title="Swift">
    ```swift
    let remotePeers = ditto.presence.graph.remotePeers
    let firstPeer = remotePeers.first!

    let peerMetadata = firstPeer.identityServiceMetadata
    ```
    </Tab>
    <Tab title="Kotlin">
    ```kotlin
    val remotePeers = ditto.presence.graph.remotePeers
    val firstPeer = remotePeers.first()

    val peerMetadata = firstPeer.identityServiceMetadata
    ```
    </Tab>
    <Tab title="JS">
    ```javascript
    const remotePeers = ditto.presence.graph.remotePeers
    const firstPeer = remotePeers[0]

    const peerMetadata = firstPeer.identityServiceMetadata
    ```
    </Tab>
    <Tab title="Java">
    ```java
    List<DittoPeer> remotePeers = ditto.getPresence().getGraph().remotePeers;
    DittoPeer firstPeer = remotePeers.get(0);

    Map<String, Object> metadata = firstPeer.identityServiceMetadata;
    ```
    </Tab>
    <Tab title="C#">
    ```csharp
    var RemotePeers = Ditto.Presence.Graph.RemotePeers.PeerMetadata;
    var FirstPeer = RemotePeers[0];

    var PeerMetadata = FirstPeer.IdentityServiceMetadata;
    ```
    </Tab>
    <Tab title="C++">
    ```cpp
    auto remotePeers = ditto.get_presence().graph().remote_peers;
    auto firstPeer = remotePeers[0];

    auto peerMetadata = firstPeer.identity_service_metadata();
    ```
    </Tab>
    <Tab title="Rust">
    ```rust
    let remote_peers = ditto.presence().graph().remote_peers;
    let first_peer = &remote_peers[0];

    let peer_metadata = &first_peer.identity_service_metadata;
    ```
    </Tab>
    <Tab title="Dart">
    ```dart
    // Coming Soon
    ```
    </Tab>
</Tabs>

***


