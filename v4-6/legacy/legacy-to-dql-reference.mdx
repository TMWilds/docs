---
title: Legacy-to-DQL Reference
description: "This article covers example mappings from Legacy Query APIs to DQL for basic CRUD operations as well as syncing data with the SDK."
---

## Creating Documents

<Info>
In DQL syntax, enclose string literals within single quotes (''); for example 'blue' .
</Info>
<Warning>
  Use single quotes in DQL queries to ensure accuracy. Incorrectly using double quotes (""); for example "blue", may prevent document matching. Currently, Ditto does not throw a warning for this issue.
</Warning>

### Inserting a Single Document



<CardGroup>

```javascript Legacy
const newCar = {
  _id: '123',
  color: 'blue',
}

await ditto.store
.collection('cars')
.upsert(newCar)
```

```javascript DQL
const newCar = {
  _id: '123',
  color: 'blue',
}

await ditto.store.execute(`
  INSERT INTO cars
  DOCUMENTS (:newCar)`,
  { newCar })
```

</CardGroup>


### Inserting Multiple Documents



<CardGroup>

```javascript   Legacy
// Not Supported
```

```javascript DQL
const car1 = {
  _id: '123',
  color: 'blue',
}
const car2 = {
  _id: '456',
  color: 'red',
}

await ditto.store.execute(`
  INSERT INTO cars
  DOCUMENTS (:car1),(:car2)`,
  { car1, car2 })
```
</CardGroup>



### Inserting Initial/Default Documents

This is the ability to insert documents at time 0. For more information see [INSERT with INITIAL DOCUMENTS](/v4-6/legacy/undefined#_89-v).


<CardGroup>
  ```javascript Legacy
const newCar = {
  _id: '123',
  color: 'blue',
}

await ditto.store
.collection('cars')
.upsert(newCar, { writeStrategy: "insertDefaultIfAbsent" })
```

```javascript DQL
const newCar = {
  _id: '123',
  color: 'blue',
}

await ditto.store.execute(`
  INSERT INTO cars
  INITIAL DOCUMENTS (:newCar)`,
  { newCar })
```
</CardGroup>

### Upserting Documents

Legacy supports upserting by default where DQL requires the policy to be explicitly set.

<CardGroup>

```javascript Legacy
const newCar = {
  _id: '123',
  color: 'blue',
}

await ditto.store
.collection('cars')
.upsert(newCar)
```

```javascript DQL
const newCar = {
  _id: '123',
  color: 'blue',
}

await ditto.store.execute(`
  INSERT INTO cars
  DOCUMENTS (:newCar)
  ON ID CONFLICT DO UPDATE`,
  { newCar })
```
</CardGroup>


## Reading Data&

### Querying Data


<CardGroup>
  ```javascript Legacy
await ditto.store
.collection('cars')
.find('color == "blue"')
```
```javascript DQL
await ditto.store.execute(`
  SELECT *
  FROM cars
  WHERE color = 'blue'
  `)
```
</CardGroup>


### Querying Data by ID


<CardGroup>
```javascript Legacy
await ditto.store
.collection('cars')
.findById('123')
```

```javascript DQL
await ditto.store.execute(`
  SELECT *
  FROM cars
  WHERE _id = '123'
  `)
```
</CardGroup>

### Querying Data with Limits


<CardGroup>
  ```javascript Legacy
await ditto.store
.collection('cars')
.find('color == "blue"')
.limit(10)
```

```javascript DQL
await ditto.store.execute(`
  SELECT *
  FROM cars
  WHERE color = 'blue'
  LIMIT 10
  `)
```
</CardGroup>


### Querying for Null Values


<CardGroup>
```javascript Legacy
await ditto.store
.collection('cars')
.find('color == null')
```

```javascript DQL
await ditto.store.execute(`
  SELECT *
  FROM cars
  WHERE color IS NULL
  `)
```
</CardGroup>

### Querying with Arguments

<CardGroup>
  ```javascript Legacy
await ditto.store
.collection('cars')
.find(
  'color == $args.color',
  { color: 'blue' })
```


```javascript DQL
await ditto.store.execute(`
  SELECT *
  FROM cars
  WHERE color = :color`,
  { color: 'blue' })
```
</CardGroup>


### Observing Data Changes


<CardGroup>
  ```javascript Legacy
const observer = ditto.store
.collection('cars')
.find('color = "blue"')
.observeLocal((result, event) => {
    // do something
  })
```

```javascript DQL
ditto.store.registerObserver(`
  SELECT *
  FROM cars
  WHERE color = 'blue'`,
  (result) => {
    // handle change
  })
```
</CardGroup>



## Updating Documents

### Updating a Single Document


<CardGroup>
  ```javascript Legacy
await ditto.store
.collection('cars')
.findByID('123')
.update((mutableDoc) => {
  mutableDoc.at('color').set('red')
})
```


```javascript DQL
await ditto.store.execute(`
  UPDATE cars
  SET color = 'red'
  WHERE _id = '123'
  `)
```
</CardGroup>

### Updating Multiple Documents


<CardGroup>
  ```javascript Legacy
await ditto.store
  .collection('cars')
  .find('color == "blue"')
  .update((documents) => {
    for (const document of documents) {
      document.color = 'red'
    }
  })
```

```javascript DQL
await ditto.store.execute(`
  UPDATE cars
  SET color = 'red'
  WHERE color = 'blue'
  `)
```
</CardGroup>

### Updating Multiple Fields


<CardGroup>
```javascript Legacy
await ditto.store
.collection('cars')
.findByID('123')
.update((mutableDoc) => {
  mutableDoc.at('color').set('red')
  mutableDoc.at('mileage').set(3001)
})
```

```javascript DQL
await ditto.store.execute(`
  UPDATE cars
  SET
    color = 'red',
    mileage = 3001
  WHERE _id = '123'
  `)
```
</CardGroup>

## Deleting Documents

### Evicting Documents

<CardGroup>
  ```javascript Legacy
await ditto.store
.collection('cars')
.find('color == "blue"')
.evict()
```

```javascript DQL
await ditto.store.execute(`
  EVICT FROM cars
  WHERE color = 'blue'
  `)
```
</CardGroup>


### Deleting Documents


<CardGroup>
  ```javascript Legacy
await ditto.store
.collection('cars')
.find('color == "blue"')
.remove()
```

```javascript DQL
// Not Supported (use EVICT)
```
</CardGroup>

## Syncing Data From Other Peers

<CardGroup>
  ```javascript Legacy
ditto.store
.collection('cars')
.find('color == "blue"')
.subscribe()
```

```javascript DQL
ditto.sync.registerSubscription(`
  SELECT *
  FROM cars
  WHERE color = 'blue'
  `)
```
</CardGroup>

